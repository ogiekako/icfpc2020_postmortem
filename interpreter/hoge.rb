#!/usr/bin/env ruby
# frozen_string_literal: true

m = {}
File.open('galaxy.txt').readlines.each do |l|
  ss = l.split(' = ')
  m[ss[0]] = ss[1].strip
end

# puts m

i = 'ap ap ap c :1131 ap ap :1131 ap ap :1131 ap ap ap c :1183 ap ap ap c ap ap c :1173 ap neg 3 ap neg 12 ap ap cons -108 0 ap :1264 ap ap ap c :1141 2 ap car ap ap cons ap ap cons 5 ap ap cons 270608505102339400 ap ap cons 5 ap ap cons 8 ap ap cons 0 ap ap cons ap neg 71253615015 ap ap cons ap s t nil ap ap ap ap ap b c ap c :1133 nil ap ap s ap ap b c ap ap b ap s ap ap b ap eq 270608505102339400 ap ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c :1141 ap add -1 ap add -1 1 ap c cons i nil ap ap ap c :1183 ap ap ap c ap ap c :1173 ap neg 3 6 ap ap cons -108 0 ap :1264 ap ap ap c :1141 3 ap car ap ap cons ap ap cons 5 ap ap cons 270608505102339400 ap ap cons 5 ap ap cons 8 ap ap cons 0 ap ap cons ap neg 71253615015 ap ap cons ap s t nil ap ap ap ap ap b c ap c :1133 nil ap ap s ap ap b c ap ap b ap s ap ap b ap eq 270608505102339400 ap ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c :1141 ap add -1 ap add -1 1 ap c cons i nil ap ap ap c :1183 ap ap cons -108 0 ap ap ap c ap :1195 ap ap add -7 ap neg 5 7 ap ap ap c ap ap c i 9 ap neg 10 ap ap ap b ap eq 0 ap ap c :1141 4 ap ap cons 5 ap ap cons 270608505102339400 ap ap cons 5 ap ap cons 8 ap ap cons 0 ap ap cons ap neg 71253615015 ap ap cons ap s t nil ap ap ap c :1126 ap ap c :1172 ap ap :1162 0 0 ap ap ap c :1131 ap i ap ap ap ap ap ap ap ap ap c ap ap b b ap ap b b ap ap b b ap ap b b ap ap b b ap ap b c ap ap c ap ap b c ap ap s ap ap b s ap ap b ap b ap ap s i i lt eq nil ap ap b ap b ap c ap ap b b ap ap b c ap ap b ap b :1131 ap ap c ap ap b b ap :1196 1 ap add -1 ap ap c ap ap b b ap ap b b ap ap b :1183 :1214 ap ap b :1162 ap add -3 1 ap ap ap c :1141 7 ap ap cons 2 ap ap ap ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 cons ap ap b ap b ap c ap ap b b :1115 ap ap b c ap ap b ap c :1144 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 7 ap ap ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c :1141 ap add -1 ap add -1 1 ap send ap car ap ap cons ap ap cons 0 nil nil ap ap cons 0 ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons 0 nil ap ap ap b ap mul ap neg 18 ap ap c add 1 ap neg 5 48 51 ap ap ap c add 3 ap ap ap b ap mul ap neg 18 ap ap c add 1 ap neg 5 ap :1128 :1247 ap ap ap c :1131 ap i ap ap ap ap ap ap b ap b ap b ap b :1134 ap ap c ap ap b b ap ap b b ap ap b c ap ap b ap b :1126 ap ap b ap b ap :1135 :1247 ap ap b ap b ap c ap ap b ap c ap ap s ap ap b s ap ap b ap b ap ap s i i lt eq ap ap c :1141 0 ap ap b add neg ap ap c ap ap b b ap ap b s ap ap b ap b :1183 ap ap b ap b :1214 ap ap c ap ap b b ap ap b add neg ap ap c :1141 5 ap c ap ap b :1162 ap ap b ap add -3 ap ap b :1175 ap ap b :1266 ap ap c :1141 0 1 ap ap ap c :1141 7 ap ap cons 2 ap ap ap ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 :1115 ap ap b ap b ap c ap ap b b cons ap ap b c ap ap b ap c ap ap c ap ap b b b ap ap s ap ap b s ap ap b ap b b ap ap b ap b s ap ap c ap ap b b ap ap b b ap eq 0 cons ap ap b ap b ap c ap ap b b :1115 ap ap b c ap ap b ap c :1144 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 ap add -1 7 ap ap ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c ap ap c b ap ap s ap ap b c ap ap b ap b b ap eq 0 ap ap b ap c :1141 ap add -1 ap add -1 1 ap send ap car ap ap cons ap ap cons 0 nil nil ap ap cons 0 ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons nil ap ap cons 0 nil 51 ap :1128 :1247 ap ap ap c :1126 ap ap c :1172 ap ap :1162 0 51 ap ap ap c :1131 ap i ap ap ap ap c ap ap b c ap ap c ap ap b b ap ap c lt 0 ap ap c ap ap b cons ap ap b ap :1162 0 ap ap c add 1 nil nil 0 1 ap ap ap c :1126 ap ap b ap :1162 0 ap add 1 ap ap ap b :1138 ap add -1 1'

seen = {}
loop do
  updated = false
  i = i.split.map do |t|
    if (m.key? t) && (!seen[t])
      seen[t] = true
      updated = true
      m[t]
    else
      t
    end
  end.join(' ')

  break unless updated
end

puts i.split.sort.uniq
